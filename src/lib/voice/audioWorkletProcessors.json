"\"use strict\";\n(() => {\n  var __create = Object.create;\n  var __defProp = Object.defineProperty;\n  var __getOwnPropDesc = Object.getOwnPropertyDescriptor;\n  var __getOwnPropNames = Object.getOwnPropertyNames;\n  var __getProtoOf = Object.getPrototypeOf;\n  var __hasOwnProp = Object.prototype.hasOwnProperty;\n  var __commonJS = (cb, mod) => function __require() {\n    return mod || (0, cb[__getOwnPropNames(cb)[0]])((mod = { exports: {} }).exports, mod), mod.exports;\n  };\n  var __copyProps = (to, from, except, desc) => {\n    if (from && typeof from === \"object\" || typeof from === \"function\") {\n      for (let key of __getOwnPropNames(from))\n        if (!__hasOwnProp.call(to, key) && key !== except)\n          __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });\n    }\n    return to;\n  };\n  var __toESM = (mod, isNodeMode, target) => (target = mod != null ? __create(__getProtoOf(mod)) : {}, __copyProps(\n    isNodeMode || !mod || !mod.__esModule ? __defProp(target, \"default\", { value: mod, enumerable: true }) : target,\n    mod\n  ));\n\n  // ../node_modules/fp-future/index.js\n  var require_fp_future = __commonJS({\n    \"../node_modules/fp-future/index.js\"(exports) {\n      \"use strict\";\n      Object.defineProperty(exports, \"__esModule\", { value: true });\n      function future2() {\n        let resolver;\n        let rejecter;\n        const promise = new Promise((ok, err) => {\n          resolver = (x) => {\n            ok(x);\n            promise.isPending = false;\n          };\n          rejecter = (x) => {\n            err(x);\n            promise.isPending = false;\n          };\n        }).catch((e) => Promise.reject(e));\n        promise.resolve = resolver;\n        promise.reject = rejecter;\n        if (!(\"finally\" in promise)) {\n          promise.finally = (fn) => {\n            promise.then(fn);\n            promise.catch(fn);\n          };\n        }\n        promise.isPending = true;\n        return promise;\n      }\n      exports.future = future2;\n      exports.default = future2;\n    }\n  });\n\n  // RingBuffer.ts\n  var import_fp_future = __toESM(require_fp_future());\n  var RingBuffer = class {\n    constructor(size, ArrayTypeConstructor) {\n      this.size = size;\n      this.ArrayTypeConstructor = ArrayTypeConstructor;\n      this.writePointer = 0;\n      this.readPointer = 0;\n      this.buffer = new this.ArrayTypeConstructor(size);\n    }\n    readAvailableCount() {\n      return this.writePointer - this.readPointer;\n    }\n    getWritePointer() {\n      return this.writePointer;\n    }\n    getReadPointer() {\n      return this.readPointer;\n    }\n    write(array, length) {\n      this.writeAt(array, this.writePointer, length);\n    }\n    read(readCount) {\n      const result = this.peek(this.readPointer, readCount);\n      this.readPointer += result.length;\n      return result;\n    }\n    peek(startPointer, readCount) {\n      const start = startPointer ? startPointer : this.readPointer;\n      const maxCountToRead = this.writePointer - this.readPointer;\n      const count = readCount ? Math.min(readCount, maxCountToRead) : maxCountToRead;\n      const readPosition = start % this.buffer.length;\n      const endIndex = readPosition + count;\n      let result;\n      if (endIndex > this.buffer.length) {\n        result = new this.ArrayTypeConstructor(count);\n        result.set(this.buffer.slice(readPosition, this.buffer.length));\n        result.set(this.buffer.slice(0, endIndex - this.buffer.length), this.buffer.length - readPosition);\n      } else {\n        result = this.buffer.slice(readPosition, endIndex);\n      }\n      return result;\n    }\n    writeAt(array, startPointer, length) {\n      const len = length || array.length;\n      let toWrite = array;\n      if (len > this.buffer.length) {\n        toWrite = array.slice(array.length - this.buffer.length, array.length);\n      }\n      const writePosition = startPointer % this.buffer.length;\n      const endIndex = writePosition + len;\n      if (endIndex > this.buffer.length) {\n        const partitionIndex = this.buffer.length - writePosition;\n        this.buffer.set(toWrite.slice(0, partitionIndex), writePosition);\n        this.buffer.set(toWrite.slice(partitionIndex, len), 0);\n      } else {\n        this.buffer.set(toWrite.slice(0, len), writePosition);\n      }\n      const endPointer = startPointer + len;\n      if (endPointer > this.writePointer) {\n        this.writePointer = endPointer;\n      }\n      this.updateReadPointerToMinReadPosition();\n    }\n    isFull() {\n      return this.readAvailableCount() >= this.size;\n    }\n    updateReadPointerToMinReadPosition() {\n      const minReadPointer = this.writePointer - this.buffer.length;\n      if (this.readPointer < minReadPointer) {\n        this.readPointer = minReadPointer;\n      }\n    }\n  };\n\n  // ../src/lib/voice/constants.ts\n  var OPUS_FRAME_SIZE_MS = 40;\n  var VOICE_CHAT_SAMPLE_RATE = 24e3;\n  var OPUS_SAMPLES_PER_FRAME = VOICE_CHAT_SAMPLE_RATE * OPUS_FRAME_SIZE_MS / 1e3;\n  var OUTPUT_NODE_BUFFER_SIZE = 2048;\n  var OUTPUT_NODE_BUFFER_DURATION = OUTPUT_NODE_BUFFER_SIZE * 1e3 / VOICE_CHAT_SAMPLE_RATE;\n\n  // audioWorkletProcessors.ts\n  var InputProcessor = class extends AudioWorkletProcessor {\n    constructor(...args) {\n      super(...args);\n      this.status = 2 /* PAUSED */;\n      this.inputSamplesCount = 0;\n      this.lastProcess = 0;\n      this.port.onmessage = (e) => {\n        if (e.data.topic === \"PAUSE\" /* PAUSE */) {\n          this.status = 1 /* PAUSE_REQUESTED */;\n        }\n        if (e.data.topic === \"RESUME\" /* RESUME */) {\n          this.status = 0 /* RECORDING */;\n          this.notify(\"ON_RECORDING\" /* ON_RECORDING */);\n        }\n        if (e.data.topic === \"CHECK_STATUS\" /* CHECK_STATUS */) {\n          if (this.status === 0 /* RECORDING */ || this.status === 1 /* PAUSE_REQUESTED */) {\n            if (this.isTimeout()) {\n              this.status = 2 /* PAUSED */;\n              this.notify(\"TIMEOUT\" /* TIMEOUT */);\n              this.notify(\"ON_PAUSED\" /* ON_PAUSED */);\n            }\n          }\n        }\n      };\n    }\n    isTimeout() {\n      return Date.now() - this.lastProcess > 1e3;\n    }\n    process(inputs, _outputs, _parameters) {\n      this.lastProcess = Date.now();\n      if (this.status === 2 /* PAUSED */)\n        return true;\n      let inputData = inputs?.[0]?.[0] ?? new Float32Array();\n      if (this.status === 1 /* PAUSE_REQUESTED */) {\n        const samplesToUse = Math.floor(inputData.length / OPUS_SAMPLES_PER_FRAME) * OPUS_SAMPLES_PER_FRAME + OPUS_SAMPLES_PER_FRAME - this.inputSamplesCount % OPUS_SAMPLES_PER_FRAME;\n        if (samplesToUse <= inputData.length) {\n          inputData = inputData.slice(0, samplesToUse);\n          this.status = 2 /* PAUSED */;\n          this.notify(\"ON_PAUSED\" /* ON_PAUSED */);\n        }\n      }\n      this.inputSamplesCount += inputData.length;\n      this.sendDataToEncode(inputData);\n      return true;\n    }\n    notify(notification) {\n      this.port.postMessage({ topic: notification });\n    }\n    sendDataToEncode(data) {\n      this.port.postMessage({ topic: \"ENCODE\" /* ENCODE */, samples: data }, [data.buffer]);\n    }\n  };\n  var OutputProcessor = class extends AudioWorkletProcessor {\n    constructor(options) {\n      super(options);\n      this.playing = false;\n      this.bufferLength = options?.processorOptions.channelBufferSize ?? 2;\n      this.sampleRate = options?.processorOptions.sampleRate ?? VOICE_CHAT_SAMPLE_RATE;\n      this.buffer = new RingBuffer(Math.floor(this.bufferLength * this.sampleRate), Float32Array);\n      this.readStartSamplesCount = (options?.processorOptions.readStartLength ?? 0.2) * this.sampleRate;\n      this.port.onmessage = (e) => {\n        if (e.data.topic === \"WRITE_SAMPLES\" /* WRITE_SAMPLES */) {\n          this.buffer.write(e.data.samples);\n        }\n      };\n    }\n    process(inputs, outputs, _parameters) {\n      const data = outputs[0][0];\n      data.fill(0);\n      const wasPlaying = this.playing;\n      const minReadCount = wasPlaying ? data.length - 1 : this.readStartSamplesCount;\n      if (this.buffer.readAvailableCount() > minReadCount) {\n        data.set(this.buffer.read(data.length));\n        if (!wasPlaying) {\n          this.changePlayingStatus(true);\n        }\n      } else {\n        if (wasPlaying) {\n          this.changePlayingStatus(false);\n        }\n      }\n      return true;\n    }\n    changePlayingStatus(playing) {\n      this.playing = playing;\n      this.port.postMessage({ topic: \"STREAM_PLAYING\" /* STREAM_PLAYING */, playing });\n    }\n  };\n  registerProcessor(\"inputProcessor\", InputProcessor);\n  registerProcessor(\"outputProcessor\", OutputProcessor);\n})();\n//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vLi4vbm9kZV9tb2R1bGVzL2ZwLWZ1dHVyZS9pbmRleC50cyIsICIuLi8uLi8uLi9vcHVzV29ya2xldC9SaW5nQnVmZmVyLnRzIiwgImNvbnN0YW50cy50cyIsICIuLi8uLi8uLi9vcHVzV29ya2xldC9hdWRpb1dvcmtsZXRQcm9jZXNzb3JzLnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyJleHBvcnQgdHlwZSBJRnV0dXJlPFQ+ID0gUHJvbWlzZTxUPiAmIHtcbiAgcmVzb2x2ZTogKHg6IFQpID0+IHZvaWQ7XG4gIHJlamVjdDogKHg6IEVycm9yKSA9PiB2b2lkO1xuICBmaW5hbGx5OiAoZm46ICgpID0+IHZvaWQpID0+IHZvaWQ7XG4gIGlzUGVuZGluZzogYm9vbGVhbjtcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiBmdXR1cmU8VCA9IGFueT4oKTogSUZ1dHVyZTxUPiB7XG4gIGxldCByZXNvbHZlcjogKHg6IFQpID0+IHZvaWQ7XG4gIGxldCByZWplY3RlcjogKHg6IEVycm9yKSA9PiB2b2lkO1xuXG4gIGNvbnN0IHByb21pc2U6IGFueSA9IG5ldyBQcm9taXNlKChvaywgZXJyKSA9PiB7XG4gICAgcmVzb2x2ZXIgPSAoeDogVCkgPT4ge1xuICAgICAgb2soeCk7XG4gICAgICBwcm9taXNlLmlzUGVuZGluZyA9IGZhbHNlO1xuICAgIH07XG4gICAgcmVqZWN0ZXIgPSAoeDogRXJyb3IpID0+IHtcbiAgICAgIGVycih4KTtcbiAgICAgIHByb21pc2UuaXNQZW5kaW5nID0gZmFsc2U7XG4gICAgfTtcbiAgfSkuY2F0Y2goZSA9PiBQcm9taXNlLnJlamVjdChlKSk7XG5cbiAgcHJvbWlzZS5yZXNvbHZlID0gcmVzb2x2ZXI7XG4gIHByb21pc2UucmVqZWN0ID0gcmVqZWN0ZXI7XG5cbiAgaWYgKCEoXCJmaW5hbGx5XCIgaW4gcHJvbWlzZSkpIHtcbiAgICBwcm9taXNlLmZpbmFsbHkgPSBmbiA9PiB7XG4gICAgICBwcm9taXNlLnRoZW4oZm4pO1xuICAgICAgcHJvbWlzZS5jYXRjaChmbik7XG4gICAgfTtcbiAgfVxuXG4gIHByb21pc2UuaXNQZW5kaW5nID0gdHJ1ZTtcblxuICByZXR1cm4gcHJvbWlzZSBhcyBJRnV0dXJlPFQ+O1xufVxuXG5leHBvcnQgZGVmYXVsdCBmdXR1cmU7XG4iLCAiaW1wb3J0IGZ1dHVyZSwgeyBJRnV0dXJlIH0gZnJvbSAnZnAtZnV0dXJlJ1xuXG50eXBlIFR5cGVkQXJyYXkgPVxuICB8IEludDhBcnJheVxuICB8IFVpbnQ4QXJyYXlcbiAgfCBVaW50OENsYW1wZWRBcnJheVxuICB8IEludDE2QXJyYXlcbiAgfCBVaW50MTZBcnJheVxuICB8IEludDMyQXJyYXlcbiAgfCBVaW50MzJBcnJheVxuICB8IEZsb2F0MzJBcnJheVxuICB8IEZsb2F0NjRBcnJheVxuXG5leHBvcnQgY2xhc3MgUmluZ0J1ZmZlcjxUIGV4dGVuZHMgVHlwZWRBcnJheT4ge1xuICBwcml2YXRlIHdyaXRlUG9pbnRlcjogbnVtYmVyID0gMFxuICBwcml2YXRlIHJlYWRQb2ludGVyOiBudW1iZXIgPSAwXG4gIHByaXZhdGUgYnVmZmVyOiBUXG5cbiAgY29uc3RydWN0b3IocHVibGljIHJlYWRvbmx5IHNpemU6IG51bWJlciwgcHJpdmF0ZSByZWFkb25seSBBcnJheVR5cGVDb25zdHJ1Y3RvcjogeyBuZXcgKHNpemU6IG51bWJlcik6IFQgfSkge1xuICAgIHRoaXMuYnVmZmVyID0gbmV3IHRoaXMuQXJyYXlUeXBlQ29uc3RydWN0b3Ioc2l6ZSlcbiAgfVxuXG4gIHJlYWRBdmFpbGFibGVDb3VudCgpIHtcbiAgICByZXR1cm4gdGhpcy53cml0ZVBvaW50ZXIgLSB0aGlzLnJlYWRQb2ludGVyXG4gIH1cblxuICBnZXRXcml0ZVBvaW50ZXIoKSB7XG4gICAgcmV0dXJuIHRoaXMud3JpdGVQb2ludGVyXG4gIH1cblxuICBnZXRSZWFkUG9pbnRlcigpIHtcbiAgICByZXR1cm4gdGhpcy5yZWFkUG9pbnRlclxuICB9XG5cbiAgd3JpdGUoYXJyYXk6IFQsIGxlbmd0aD86IG51bWJlcikge1xuICAgIHRoaXMud3JpdGVBdChhcnJheSwgdGhpcy53cml0ZVBvaW50ZXIsIGxlbmd0aClcbiAgfVxuXG4gIHJlYWQocmVhZENvdW50PzogbnVtYmVyKTogVCB7XG4gICAgY29uc3QgcmVzdWx0ID0gdGhpcy5wZWVrKHRoaXMucmVhZFBvaW50ZXIsIHJlYWRDb3VudClcblxuICAgIHRoaXMucmVhZFBvaW50ZXIgKz0gcmVzdWx0Lmxlbmd0aFxuXG4gICAgcmV0dXJuIHJlc3VsdFxuICB9XG5cbiAgcGVlayhzdGFydFBvaW50ZXI/OiBudW1iZXIsIHJlYWRDb3VudD86IG51bWJlcik6IFQge1xuICAgIGNvbnN0IHN0YXJ0ID0gc3RhcnRQb2ludGVyID8gc3RhcnRQb2ludGVyIDogdGhpcy5yZWFkUG9pbnRlclxuXG4gICAgY29uc3QgbWF4Q291bnRUb1JlYWQgPSB0aGlzLndyaXRlUG9pbnRlciAtIHRoaXMucmVhZFBvaW50ZXJcblxuICAgIGNvbnN0IGNvdW50ID0gcmVhZENvdW50ID8gTWF0aC5taW4ocmVhZENvdW50LCBtYXhDb3VudFRvUmVhZCkgOiBtYXhDb3VudFRvUmVhZFxuXG4gICAgY29uc3QgcmVhZFBvc2l0aW9uID0gc3RhcnQgJSB0aGlzLmJ1ZmZlci5sZW5ndGhcblxuICAgIGNvbnN0IGVuZEluZGV4ID0gcmVhZFBvc2l0aW9uICsgY291bnRcblxuICAgIGxldCByZXN1bHQ6IFRcblxuICAgIGlmIChlbmRJbmRleCA+IHRoaXMuYnVmZmVyLmxlbmd0aCkge1xuICAgICAgcmVzdWx0ID0gbmV3IHRoaXMuQXJyYXlUeXBlQ29uc3RydWN0b3IoY291bnQpXG4gICAgICByZXN1bHQuc2V0KHRoaXMuYnVmZmVyLnNsaWNlKHJlYWRQb3NpdGlvbiwgdGhpcy5idWZmZXIubGVuZ3RoKSlcbiAgICAgIHJlc3VsdC5zZXQodGhpcy5idWZmZXIuc2xpY2UoMCwgZW5kSW5kZXggLSB0aGlzLmJ1ZmZlci5sZW5ndGgpLCB0aGlzLmJ1ZmZlci5sZW5ndGggLSByZWFkUG9zaXRpb24pXG4gICAgfSBlbHNlIHtcbiAgICAgIHJlc3VsdCA9IHRoaXMuYnVmZmVyLnNsaWNlKHJlYWRQb3NpdGlvbiwgZW5kSW5kZXgpIGFzIFRcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0XG4gIH1cblxuICB3cml0ZUF0KGFycmF5OiBULCBzdGFydFBvaW50ZXI6IG51bWJlciwgbGVuZ3RoPzogbnVtYmVyKSB7XG4gICAgY29uc3QgbGVuID0gbGVuZ3RoIHx8IGFycmF5Lmxlbmd0aFxuXG4gICAgbGV0IHRvV3JpdGUgPSBhcnJheVxuICAgIGlmIChsZW4gPiB0aGlzLmJ1ZmZlci5sZW5ndGgpIHtcbiAgICAgIC8vIElmIHRvbyBtYW55IGJ5dGVzIGFyZSBwcm92aWRlZCwgd2Ugb25seSB3cml0ZSB0aGUgbGFzdCBvbmVzLlxuICAgICAgdG9Xcml0ZSA9IGFycmF5LnNsaWNlKGFycmF5Lmxlbmd0aCAtIHRoaXMuYnVmZmVyLmxlbmd0aCwgYXJyYXkubGVuZ3RoKSBhcyBUXG4gICAgfVxuXG4gICAgY29uc3Qgd3JpdGVQb3NpdGlvbiA9IHN0YXJ0UG9pbnRlciAlIHRoaXMuYnVmZmVyLmxlbmd0aFxuXG4gICAgY29uc3QgZW5kSW5kZXggPSB3cml0ZVBvc2l0aW9uICsgbGVuXG5cbiAgICBpZiAoZW5kSW5kZXggPiB0aGlzLmJ1ZmZlci5sZW5ndGgpIHtcbiAgICAgIGNvbnN0IHBhcnRpdGlvbkluZGV4ID0gdGhpcy5idWZmZXIubGVuZ3RoIC0gd3JpdGVQb3NpdGlvblxuICAgICAgdGhpcy5idWZmZXIuc2V0KHRvV3JpdGUuc2xpY2UoMCwgcGFydGl0aW9uSW5kZXgpLCB3cml0ZVBvc2l0aW9uKVxuICAgICAgdGhpcy5idWZmZXIuc2V0KHRvV3JpdGUuc2xpY2UocGFydGl0aW9uSW5kZXgsIGxlbiksIDApXG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuYnVmZmVyLnNldCh0b1dyaXRlLnNsaWNlKDAsIGxlbiksIHdyaXRlUG9zaXRpb24pXG4gICAgfVxuXG4gICAgY29uc3QgZW5kUG9pbnRlciA9IHN0YXJ0UG9pbnRlciArIGxlblxuXG4gICAgaWYgKGVuZFBvaW50ZXIgPiB0aGlzLndyaXRlUG9pbnRlcikge1xuICAgICAgdGhpcy53cml0ZVBvaW50ZXIgPSBlbmRQb2ludGVyXG4gICAgfVxuXG4gICAgdGhpcy51cGRhdGVSZWFkUG9pbnRlclRvTWluUmVhZFBvc2l0aW9uKClcbiAgfVxuXG4gIGlzRnVsbCgpIHtcbiAgICByZXR1cm4gdGhpcy5yZWFkQXZhaWxhYmxlQ291bnQoKSA+PSB0aGlzLnNpemVcbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlUmVhZFBvaW50ZXJUb01pblJlYWRQb3NpdGlvbigpIHtcbiAgICBjb25zdCBtaW5SZWFkUG9pbnRlciA9IHRoaXMud3JpdGVQb2ludGVyIC0gdGhpcy5idWZmZXIubGVuZ3RoXG5cbiAgICBpZiAodGhpcy5yZWFkUG9pbnRlciA8IG1pblJlYWRQb2ludGVyKSB7XG4gICAgICB0aGlzLnJlYWRQb2ludGVyID0gbWluUmVhZFBvaW50ZXJcbiAgICB9XG4gIH1cbn1cblxudHlwZSBDaHVuayA9IHtcbiAgb3JkZXI6IG51bWJlclxuICBzdGFydFBvaW50ZXI6IG51bWJlclxuICBsZW5ndGg6IG51bWJlclxufVxuXG5leHBvcnQgY2xhc3MgT3JkZXJlZFJpbmdCdWZmZXI8VCBleHRlbmRzIFR5cGVkQXJyYXk+IHtcbiAgcHJpdmF0ZSBpbnRlcm5hbFJpbmdCdWZmZXI6IFJpbmdCdWZmZXI8VD5cblxuICBwcml2YXRlIGNodW5rczogQ2h1bmtbXSA9IFtdXG5cbiAgcHJpdmF0ZSBibG9ja2VkUmVhZENodW5rc0Z1dHVyZT86IHsgY2h1bmtzVG9SZWFkOiBudW1iZXI7IGZ1dHVyZTogSUZ1dHVyZTxUW10+IH1cblxuICBjb25zdHJ1Y3RvcihwdWJsaWMgcmVhZG9ubHkgc2l6ZTogbnVtYmVyLCBBcnJheVR5cGVDb25zdHJ1Y3RvcjogeyBuZXcgKHNpemU6IG51bWJlcik6IFQgfSkge1xuICAgIHRoaXMuaW50ZXJuYWxSaW5nQnVmZmVyID0gbmV3IFJpbmdCdWZmZXIoc2l6ZSwgQXJyYXlUeXBlQ29uc3RydWN0b3IpXG4gIH1cblxuICByZWFkQXZhaWxhYmxlQ291bnQoKSB7XG4gICAgcmV0dXJuIHRoaXMuaW50ZXJuYWxSaW5nQnVmZmVyLnJlYWRBdmFpbGFibGVDb3VudCgpXG4gIH1cblxuICB3cml0ZShhcnJheTogVCwgb3JkZXI6IG51bWJlciwgbGVuZ3RoPzogbnVtYmVyKSB7XG4gICAgLy8gV2UgZmluZCB0aG9zZSBjaHVua3MgdGhhdCBzaG91bGQgYmUgYWZ0ZXIgdGhpcyBjaHVua1xuICAgIGNvbnN0IG5leHRDaHVua3MgPSB0aGlzLmNodW5rcy5maWx0ZXIoKGl0KSA9PiBpdC5vcmRlciA+IG9yZGVyKVxuXG4gICAgaWYgKG5leHRDaHVua3MubGVuZ3RoID09PSAwKSB7XG4gICAgICAvLyBJZiB0aGVyZSBhcmUgbm8gY2h1bmtzIHRoYXQgc2hvdWxkIGJlIGFmdGVyIHRoaXMgY2h1bmssIHRoZW4gd2UganVzdCBuZWVkIHRvIHdyaXRlIHRoZSBjaHVuayBhdCB0aGUgZW5kLlxuICAgICAgdGhpcy5jaHVua3MucHVzaCh7XG4gICAgICAgIG9yZGVyLFxuICAgICAgICBzdGFydFBvaW50ZXI6IHRoaXMuaW50ZXJuYWxSaW5nQnVmZmVyLmdldFdyaXRlUG9pbnRlcigpLFxuICAgICAgICBsZW5ndGg6IGxlbmd0aCB8fCBhcnJheS5sZW5ndGhcbiAgICAgIH0pXG5cbiAgICAgIHRoaXMuaW50ZXJuYWxSaW5nQnVmZmVyLndyaXRlKGFycmF5LCBsZW5ndGgpXG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIE90aGVyd2lzZSwgd2UgbmVlZCB0byBnZXQgdGhvc2UgY2h1bmtzIHRoYXQgc2hvdWxkIGJlIGFmdGVyIHRoaXMgb25lLCBhbmQgd3JpdGUgdGhlbSBvbmUgYWZ0ZXIgdGhlIG90aGVyXG5cbiAgICAgIGxldCB3cml0ZVBvaW50ZXIgPSBuZXh0Q2h1bmtzWzBdLnN0YXJ0UG9pbnRlclxuXG4gICAgICBjb25zdCBuZXdDaHVuayA9IHtcbiAgICAgICAgb3JkZXIsXG4gICAgICAgIHN0YXJ0UG9pbnRlcjogd3JpdGVQb2ludGVyLFxuICAgICAgICBsZW5ndGg6IGxlbmd0aCB8fCBhcnJheS5sZW5ndGhcbiAgICAgIH1cblxuICAgICAgLy8gQ2h1bmtzIGFyZSBvcmRlcmVkIGJ5IFwib3JkZXJcIiwgc28gd2UgbmVlZCB0byBlbnN1cmUgdGhhdCB3ZSBwbGFjZSB0aGlzIG5ldyBjaHVuayBpbiB0aGUgY29ycmVzcG9uZGluZyBpbmRleC5cbiAgICAgIHRoaXMuY2h1bmtzLnNwbGljZSh0aGlzLmNodW5rcy5sZW5ndGggLSBuZXh0Q2h1bmtzLmxlbmd0aCwgMCwgbmV3Q2h1bmspXG5cbiAgICAgIGNvbnN0IGFycmF5c1RvV3JpdGUgPSBbbGVuZ3RoID8gYXJyYXkuc2xpY2UoMCwgbGVuZ3RoKSA6IGFycmF5XSBhcyBUW11cblxuICAgICAgLy8gV2UgZ2V0IHRoZSBhcnJheXMgZm9yIGVhY2ggY2h1bmssIGFuZCB3ZSB1cGRhdGUgdGhlaXIgcG9pbnRlcnMgd2hpbGUgd2UgYXJlIGF0IGl0XG4gICAgICBuZXh0Q2h1bmtzLmZvckVhY2goKGNodW5rKSA9PiB7XG4gICAgICAgIGFycmF5c1RvV3JpdGUucHVzaCh0aGlzLmFycmF5Rm9yQ2h1bmsoY2h1bmspKVxuXG4gICAgICAgIGNodW5rLnN0YXJ0UG9pbnRlciArPSBuZXdDaHVuay5sZW5ndGhcbiAgICAgIH0pXG5cbiAgICAgIC8vIFdlIHdyaXRlIHN0YXJ0aW5nIGZyb20gdGhlIHBvc2l0aW9uIG9mIHRoZSBmaXJzdCBjaHVuayB0aGF0IHdpbGwgYmUgcmV3cml0dGVuXG4gICAgICBhcnJheXNUb1dyaXRlLmZvckVhY2goKHRvV3JpdGUpID0+IHtcbiAgICAgICAgdGhpcy5pbnRlcm5hbFJpbmdCdWZmZXIud3JpdGVBdCh0b1dyaXRlLCB3cml0ZVBvaW50ZXIpXG4gICAgICAgIHdyaXRlUG9pbnRlciArPSB0b1dyaXRlLmxlbmd0aFxuICAgICAgfSlcbiAgICB9XG5cbiAgICB0aGlzLmRpc2NhcmRVbnJlYWRhYmxlQ2h1bmtzKClcbiAgICB0aGlzLnJlc29sdmVCbG9ja2VkUmVhZCgpXG4gIH1cblxuICBhcnJheUZvckNodW5rKGNodW5rOiBDaHVuayk6IFQge1xuICAgIHJldHVybiB0aGlzLnBlZWsoY2h1bmsuc3RhcnRQb2ludGVyLCBjaHVuay5sZW5ndGgpXG4gIH1cblxuICBwZWVrKHN0YXJ0UG9pbnRlcj86IG51bWJlciwgcmVhZENvdW50PzogbnVtYmVyKTogVCB7XG4gICAgcmV0dXJuIHRoaXMuaW50ZXJuYWxSaW5nQnVmZmVyLnBlZWsoc3RhcnRQb2ludGVyLCByZWFkQ291bnQpXG4gIH1cblxuICByZWFkKHJlYWRDb3VudD86IG51bWJlcik6IFQge1xuICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuaW50ZXJuYWxSaW5nQnVmZmVyLnJlYWQocmVhZENvdW50KVxuXG4gICAgdGhpcy5kaXNjYXJkVW5yZWFkYWJsZUNodW5rcygpXG5cbiAgICByZXR1cm4gcmVzdWx0XG4gIH1cblxuICAvKipcbiAgICogVGhlIHByb21pc2Ugd2lsbCBibG9jayB1bnRpbCB0aGVyZSBpcyBjaHVua3NDb3VudCBjaHVua3MgdG8gcmVhZCxcbiAgICogb3IgdW50aWwgdGltZVRvV2FpdCBoYXMgcGFzc2VkLlxuICAgKlxuICAgKiBPbmNlIHRpbWVUb1dhaXQgaGFzIHBhc3NlZCwgaWYgdGhlcmUgaXMgbm90aGluZyB0byByZWFkLCBhbiBlbXB0eSBhcnJheSBpcyByZXR1cm5lZC5cbiAgICovXG4gIGFzeW5jIGJsb2NrQW5kUmVhZENodW5rcyhjaHVua3NDb3VudDogbnVtYmVyLCB0aW1lVG9XYWl0OiBudW1iZXIpOiBQcm9taXNlPFRbXT4ge1xuICAgIGlmICh0aGlzLmNodW5rcy5sZW5ndGggPj0gY2h1bmtzQ291bnQpIHtcbiAgICAgIGNvbnN0IGNodW5rcyA9IHRoaXMucmVhZENodW5rcyhjaHVua3NDb3VudClcblxuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShjaHVua3MpXG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICh0aGlzLmJsb2NrZWRSZWFkQ2h1bmtzRnV0dXJlKSB7XG4gICAgICAgIHRoaXMuYmxvY2tlZFJlYWRDaHVua3NGdXR1cmUuZnV0dXJlLnJlamVjdChuZXcgRXJyb3IoJ09ubHkgb25lIGJsb2NraW5nIGNhbGwgaXMgcG9zc2libGUgYXQgdGhlIHNhbWUgdGltZScpKVxuICAgICAgfVxuXG4gICAgICBjb25zdCB0aGlzRnV0dXJlID0geyBjaHVua3NUb1JlYWQ6IGNodW5rc0NvdW50LCBmdXR1cmU6IGZ1dHVyZSgpIH1cblxuICAgICAgdGhpcy5ibG9ja2VkUmVhZENodW5rc0Z1dHVyZSA9IHRoaXNGdXR1cmVcblxuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLmJsb2NrZWRSZWFkQ2h1bmtzRnV0dXJlID09PSB0aGlzRnV0dXJlKSB7XG4gICAgICAgICAgaWYgKHRoaXMuY2h1bmtzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHRoaXNGdXR1cmUuZnV0dXJlLnJlc29sdmUodGhpcy5yZWFkQ2h1bmtzKHRoaXMuY2h1bmtzLmxlbmd0aCkpXG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXNGdXR1cmUuZnV0dXJlLnJlc29sdmUoW10pXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9LCB0aW1lVG9XYWl0KVxuXG4gICAgICByZXR1cm4gdGhpcy5ibG9ja2VkUmVhZENodW5rc0Z1dHVyZS5mdXR1cmVcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHJlYWRDaHVua3MoY2h1bmtzQ291bnQ6IG51bWJlcikge1xuICAgIHJldHVybiB0aGlzLmNodW5rcy5zbGljZSgwLCBjaHVua3NDb3VudCkubWFwKChpdCkgPT4gdGhpcy5yZWFkKGl0Lmxlbmd0aCkpXG4gIH1cblxuICBwcml2YXRlIGRpc2NhcmRVbnJlYWRhYmxlQ2h1bmtzKCkge1xuICAgIGNvbnN0IGlzUmVhZGFibGUgPSAoY2h1bms6IENodW5rKSA9PiB7XG4gICAgICAvLyBBIGNodW5rIGlzIHJlYWRhYmxlIGlmIGl0cyBlbmQgcG9pbnRlciBpcyBhaGVhZCBvZiB0aGUgcmVhZCBwb2ludGVyXG4gICAgICBjb25zdCBlbmRQb2ludGVyID0gY2h1bmsuc3RhcnRQb2ludGVyICsgY2h1bmsubGVuZ3RoXG4gICAgICByZXR1cm4gZW5kUG9pbnRlciA+IHRoaXMuaW50ZXJuYWxSaW5nQnVmZmVyLmdldFJlYWRQb2ludGVyKClcbiAgICB9XG5cbiAgICB0aGlzLmNodW5rcyA9IHRoaXMuY2h1bmtzLmZpbHRlcihpc1JlYWRhYmxlKVxuXG4gICAgaWYgKHRoaXMuY2h1bmtzLmxlbmd0aCA+IDAgJiYgdGhpcy5jaHVua3NbMF0uc3RhcnRQb2ludGVyIDwgdGhpcy5pbnRlcm5hbFJpbmdCdWZmZXIuZ2V0UmVhZFBvaW50ZXIoKSkge1xuICAgICAgdGhpcy5jaHVua3NbMF0uc3RhcnRQb2ludGVyID0gdGhpcy5pbnRlcm5hbFJpbmdCdWZmZXIuZ2V0UmVhZFBvaW50ZXIoKVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgcmVzb2x2ZUJsb2NrZWRSZWFkKCkge1xuICAgIGlmICh0aGlzLmJsb2NrZWRSZWFkQ2h1bmtzRnV0dXJlICYmIHRoaXMuY2h1bmtzLmxlbmd0aCA+PSB0aGlzLmJsb2NrZWRSZWFkQ2h1bmtzRnV0dXJlLmNodW5rc1RvUmVhZCkge1xuICAgICAgY29uc3QgcmVhZCA9IHRoaXMucmVhZENodW5rcyh0aGlzLmJsb2NrZWRSZWFkQ2h1bmtzRnV0dXJlLmNodW5rc1RvUmVhZClcbiAgICAgIHRoaXMuYmxvY2tlZFJlYWRDaHVua3NGdXR1cmUuZnV0dXJlLnJlc29sdmUocmVhZClcbiAgICAgIGRlbGV0ZSB0aGlzLmJsb2NrZWRSZWFkQ2h1bmtzRnV0dXJlXG4gICAgfVxuICB9XG59XG4iLCAiZXhwb3J0IGNvbnN0IE9QVVNfQklUU19QRVJfU0VDT05EID0gMjQwMDBcbmV4cG9ydCBjb25zdCBPUFVTX0ZSQU1FX1NJWkVfTVMgPSA0MFxuXG5leHBvcnQgY29uc3QgVk9JQ0VfQ0hBVF9TQU1QTEVfUkFURSA9IDI0MDAwXG5cbmV4cG9ydCBjb25zdCBPUFVTX1NBTVBMRVNfUEVSX0ZSQU1FID0gKFZPSUNFX0NIQVRfU0FNUExFX1JBVEUgKiBPUFVTX0ZSQU1FX1NJWkVfTVMpIC8gMTAwMFxuXG5leHBvcnQgY29uc3QgT1VUUFVUX05PREVfQlVGRkVSX1NJWkUgPSAyMDQ4XG5leHBvcnQgY29uc3QgT1VUUFVUX05PREVfQlVGRkVSX0RVUkFUSU9OID0gKE9VVFBVVF9OT0RFX0JVRkZFUl9TSVpFICogMTAwMCkgLyBWT0lDRV9DSEFUX1NBTVBMRV9SQVRFXG5cbmV4cG9ydCBjb25zdCBJTlBVVF9OT0RFX0JVRkZFUl9TSVpFID0gMjA0OFxuIiwgImltcG9ydCB7IFJpbmdCdWZmZXIgfSBmcm9tICcuL1JpbmdCdWZmZXInXG5pbXBvcnQgeyBPUFVTX1NBTVBMRVNfUEVSX0ZSQU1FLCBWT0lDRV9DSEFUX1NBTVBMRV9SQVRFIH0gZnJvbSAnLi4vc3JjL2xpYi92b2ljZS9jb25zdGFudHMnXG5pbXBvcnQgeyBJbnB1dFdvcmtsZXRSZXF1ZXN0VG9waWMsIE91dHB1dFdvcmtsZXRSZXF1ZXN0VG9waWMgfSBmcm9tICcuLi9zcmMvbGliL3ZvaWNlL3R5cGVzJ1xuXG5leHBvcnQgaW50ZXJmYWNlIEF1ZGlvV29ya2xldFByb2Nlc3NvciB7XG4gIHJlYWRvbmx5IHBvcnQ6IE1lc3NhZ2VQb3J0XG4gIHByb2Nlc3MoaW5wdXRzOiBGbG9hdDMyQXJyYXlbXVtdLCBvdXRwdXRzOiBGbG9hdDMyQXJyYXlbXVtdLCBwYXJhbWV0ZXJzOiBSZWNvcmQ8c3RyaW5nLCBGbG9hdDMyQXJyYXk+KTogYm9vbGVhblxufVxuXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdmFyXG5kZWNsYXJlIHZhciBBdWRpb1dvcmtsZXRQcm9jZXNzb3I6IHtcbiAgcHJvdG90eXBlOiBBdWRpb1dvcmtsZXRQcm9jZXNzb3JcbiAgbmV3IChvcHRpb25zPzogQXVkaW9Xb3JrbGV0Tm9kZU9wdGlvbnMpOiBBdWRpb1dvcmtsZXRQcm9jZXNzb3Jcbn1cblxudHlwZSBBdWRpb1BhcmFtRGVzY3JpcHRvciA9IFJlY29yZDxzdHJpbmcsIEZsb2F0MzJBcnJheT5cblxuZGVjbGFyZSBmdW5jdGlvbiByZWdpc3RlclByb2Nlc3NvcihcbiAgbmFtZTogc3RyaW5nLFxuICBwcm9jZXNzb3JDdG9yOiAobmV3IChvcHRpb25zPzogQXVkaW9Xb3JrbGV0Tm9kZU9wdGlvbnMpID0+IEF1ZGlvV29ya2xldFByb2Nlc3NvcikgJiB7XG4gICAgcGFyYW1ldGVyRGVzY3JpcHRvcnM/OiBBdWRpb1BhcmFtRGVzY3JpcHRvcltdXG4gIH1cbik6IHZvaWRcblxuZW51bSBJbnB1dFByb2Nlc3NvclN0YXR1cyB7XG4gIFJFQ09SRElORyxcbiAgUEFVU0VfUkVRVUVTVEVELFxuICBQQVVTRURcbn1cblxuY2xhc3MgSW5wdXRQcm9jZXNzb3IgZXh0ZW5kcyBBdWRpb1dvcmtsZXRQcm9jZXNzb3Ige1xuICBzdGF0dXM6IElucHV0UHJvY2Vzc29yU3RhdHVzID0gSW5wdXRQcm9jZXNzb3JTdGF0dXMuUEFVU0VEXG4gIGlucHV0U2FtcGxlc0NvdW50OiBudW1iZXIgPSAwXG4gIGxhc3RQcm9jZXNzOiBudW1iZXIgPSAwXG5cbiAgY29uc3RydWN0b3IoLi4uYXJnczogYW55W10pIHtcbiAgICBzdXBlciguLi5hcmdzKVxuXG4gICAgdGhpcy5wb3J0Lm9ubWVzc2FnZSA9IChlKSA9PiB7XG4gICAgICBpZiAoZS5kYXRhLnRvcGljID09PSBJbnB1dFdvcmtsZXRSZXF1ZXN0VG9waWMuUEFVU0UpIHtcbiAgICAgICAgdGhpcy5zdGF0dXMgPSBJbnB1dFByb2Nlc3NvclN0YXR1cy5QQVVTRV9SRVFVRVNURURcbiAgICAgIH1cblxuICAgICAgaWYgKGUuZGF0YS50b3BpYyA9PT0gSW5wdXRXb3JrbGV0UmVxdWVzdFRvcGljLlJFU1VNRSkge1xuICAgICAgICB0aGlzLnN0YXR1cyA9IElucHV0UHJvY2Vzc29yU3RhdHVzLlJFQ09SRElOR1xuICAgICAgICB0aGlzLm5vdGlmeShJbnB1dFdvcmtsZXRSZXF1ZXN0VG9waWMuT05fUkVDT1JESU5HKVxuICAgICAgfVxuXG4gICAgICBpZiAoZS5kYXRhLnRvcGljID09PSBJbnB1dFdvcmtsZXRSZXF1ZXN0VG9waWMuQ0hFQ0tfU1RBVFVTKSB7XG4gICAgICAgIGlmICh0aGlzLnN0YXR1cyA9PT0gSW5wdXRQcm9jZXNzb3JTdGF0dXMuUkVDT1JESU5HIHx8IHRoaXMuc3RhdHVzID09PSBJbnB1dFByb2Nlc3NvclN0YXR1cy5QQVVTRV9SRVFVRVNURUQpIHtcbiAgICAgICAgICBpZiAodGhpcy5pc1RpbWVvdXQoKSkge1xuICAgICAgICAgICAgdGhpcy5zdGF0dXMgPSBJbnB1dFByb2Nlc3NvclN0YXR1cy5QQVVTRURcbiAgICAgICAgICAgIHRoaXMubm90aWZ5KElucHV0V29ya2xldFJlcXVlc3RUb3BpYy5USU1FT1VUKVxuICAgICAgICAgICAgdGhpcy5ub3RpZnkoSW5wdXRXb3JrbGV0UmVxdWVzdFRvcGljLk9OX1BBVVNFRClcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBpc1RpbWVvdXQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIERhdGUubm93KCkgLSB0aGlzLmxhc3RQcm9jZXNzID4gMTAwMFxuICB9XG5cbiAgcHJvY2VzcyhpbnB1dHM6IEZsb2F0MzJBcnJheVtdW10sIF9vdXRwdXRzOiBGbG9hdDMyQXJyYXlbXVtdLCBfcGFyYW1ldGVyczogUmVjb3JkPHN0cmluZywgRmxvYXQzMkFycmF5Pikge1xuICAgIHRoaXMubGFzdFByb2Nlc3MgPSBEYXRlLm5vdygpXG4gICAgaWYgKHRoaXMuc3RhdHVzID09PSBJbnB1dFByb2Nlc3NvclN0YXR1cy5QQVVTRUQpIHJldHVybiB0cnVlXG4gICAgbGV0IGlucHV0RGF0YSA9IGlucHV0cz8uWzBdPy5bMF0gPz8gbmV3IEZsb2F0MzJBcnJheSgpXG5cbiAgICBpZiAodGhpcy5zdGF0dXMgPT09IElucHV0UHJvY2Vzc29yU3RhdHVzLlBBVVNFX1JFUVVFU1RFRCkge1xuICAgICAgLy8gV2UgdHJ5IHRvIHVzZSBhcyBtYW55IHNhbXBsZXMgYXMgd2UgY2FuIHRoYXQgd291bGQgY29tcGxldGUgc29tZSBmcmFtZXNcbiAgICAgIGNvbnN0IHNhbXBsZXNUb1VzZSA9XG4gICAgICAgIE1hdGguZmxvb3IoaW5wdXREYXRhLmxlbmd0aCAvIE9QVVNfU0FNUExFU19QRVJfRlJBTUUpICogT1BVU19TQU1QTEVTX1BFUl9GUkFNRSArXG4gICAgICAgIE9QVVNfU0FNUExFU19QRVJfRlJBTUUgLVxuICAgICAgICAodGhpcy5pbnB1dFNhbXBsZXNDb3VudCAlIE9QVVNfU0FNUExFU19QRVJfRlJBTUUpXG5cbiAgICAgIC8vIElmIHdlIHN0aWxsIGRvbid0IGhhdmUgZW5vdWdoIHNhbXBsZXMgdG8gY29tcGxldGUgYSBmcmFtZSwgd2UgY2Fubm90IHBhdXNlIHJlY29yZGluZyB5ZXQuXG4gICAgICBpZiAoc2FtcGxlc1RvVXNlIDw9IGlucHV0RGF0YS5sZW5ndGgpIHtcbiAgICAgICAgaW5wdXREYXRhID0gaW5wdXREYXRhLnNsaWNlKDAsIHNhbXBsZXNUb1VzZSlcbiAgICAgICAgdGhpcy5zdGF0dXMgPSBJbnB1dFByb2Nlc3NvclN0YXR1cy5QQVVTRURcbiAgICAgICAgdGhpcy5ub3RpZnkoSW5wdXRXb3JrbGV0UmVxdWVzdFRvcGljLk9OX1BBVVNFRClcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLmlucHV0U2FtcGxlc0NvdW50ICs9IGlucHV0RGF0YS5sZW5ndGhcbiAgICB0aGlzLnNlbmREYXRhVG9FbmNvZGUoaW5wdXREYXRhKVxuXG4gICAgcmV0dXJuIHRydWVcbiAgfVxuXG4gIG5vdGlmeShub3RpZmljYXRpb246IElucHV0V29ya2xldFJlcXVlc3RUb3BpYykge1xuICAgIHRoaXMucG9ydC5wb3N0TWVzc2FnZSh7IHRvcGljOiBub3RpZmljYXRpb24gfSlcbiAgfVxuXG4gIHByaXZhdGUgc2VuZERhdGFUb0VuY29kZShkYXRhOiBGbG9hdDMyQXJyYXkpIHtcbiAgICB0aGlzLnBvcnQucG9zdE1lc3NhZ2UoeyB0b3BpYzogSW5wdXRXb3JrbGV0UmVxdWVzdFRvcGljLkVOQ09ERSwgc2FtcGxlczogZGF0YSB9LCBbZGF0YS5idWZmZXJdKVxuICB9XG59XG5cbmNsYXNzIE91dHB1dFByb2Nlc3NvciBleHRlbmRzIEF1ZGlvV29ya2xldFByb2Nlc3NvciB7XG4gIGJ1ZmZlcjogUmluZ0J1ZmZlcjxGbG9hdDMyQXJyYXk+XG4gIHBsYXlpbmc6IGJvb2xlYW4gPSBmYWxzZVxuICBidWZmZXJMZW5ndGg6IG51bWJlclxuICBzYW1wbGVSYXRlOiBudW1iZXJcbiAgcmVhZFN0YXJ0U2FtcGxlc0NvdW50OiBudW1iZXJcblxuICBjb25zdHJ1Y3RvcihvcHRpb25zPzogQXVkaW9Xb3JrbGV0Tm9kZU9wdGlvbnMpIHtcbiAgICBzdXBlcihvcHRpb25zKVxuICAgIHRoaXMuYnVmZmVyTGVuZ3RoID0gb3B0aW9ucz8ucHJvY2Vzc29yT3B0aW9ucy5jaGFubmVsQnVmZmVyU2l6ZSA/PyAyLjBcbiAgICB0aGlzLnNhbXBsZVJhdGUgPSBvcHRpb25zPy5wcm9jZXNzb3JPcHRpb25zLnNhbXBsZVJhdGUgPz8gVk9JQ0VfQ0hBVF9TQU1QTEVfUkFURVxuICAgIHRoaXMuYnVmZmVyID0gbmV3IFJpbmdCdWZmZXIoTWF0aC5mbG9vcih0aGlzLmJ1ZmZlckxlbmd0aCAqIHRoaXMuc2FtcGxlUmF0ZSksIEZsb2F0MzJBcnJheSlcbiAgICB0aGlzLnJlYWRTdGFydFNhbXBsZXNDb3VudCA9IChvcHRpb25zPy5wcm9jZXNzb3JPcHRpb25zLnJlYWRTdGFydExlbmd0aCA/PyAwLjIpICogdGhpcy5zYW1wbGVSYXRlXG5cbiAgICB0aGlzLnBvcnQub25tZXNzYWdlID0gKGUpID0+IHtcbiAgICAgIGlmIChlLmRhdGEudG9waWMgPT09IE91dHB1dFdvcmtsZXRSZXF1ZXN0VG9waWMuV1JJVEVfU0FNUExFUykge1xuICAgICAgICB0aGlzLmJ1ZmZlci53cml0ZShlLmRhdGEuc2FtcGxlcylcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcm9jZXNzKGlucHV0czogRmxvYXQzMkFycmF5W11bXSwgb3V0cHV0czogRmxvYXQzMkFycmF5W11bXSwgX3BhcmFtZXRlcnM6IFJlY29yZDxzdHJpbmcsIEZsb2F0MzJBcnJheT4pIHtcbiAgICBjb25zdCBkYXRhID0gb3V0cHV0c1swXVswXVxuXG4gICAgZGF0YS5maWxsKDApXG4gICAgY29uc3Qgd2FzUGxheWluZyA9IHRoaXMucGxheWluZ1xuICAgIGNvbnN0IG1pblJlYWRDb3VudCA9IHdhc1BsYXlpbmcgPyBkYXRhLmxlbmd0aCAtIDEgOiB0aGlzLnJlYWRTdGFydFNhbXBsZXNDb3VudFxuICAgIGlmICh0aGlzLmJ1ZmZlci5yZWFkQXZhaWxhYmxlQ291bnQoKSA+IG1pblJlYWRDb3VudCkge1xuICAgICAgZGF0YS5zZXQodGhpcy5idWZmZXIucmVhZChkYXRhLmxlbmd0aCkpXG4gICAgICBpZiAoIXdhc1BsYXlpbmcpIHtcbiAgICAgICAgdGhpcy5jaGFuZ2VQbGF5aW5nU3RhdHVzKHRydWUpXG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICh3YXNQbGF5aW5nKSB7XG4gICAgICAgIHRoaXMuY2hhbmdlUGxheWluZ1N0YXR1cyhmYWxzZSlcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRydWVcbiAgfVxuXG4gIGNoYW5nZVBsYXlpbmdTdGF0dXMocGxheWluZzogYm9vbGVhbikge1xuICAgIHRoaXMucGxheWluZyA9IHBsYXlpbmdcbiAgICB0aGlzLnBvcnQucG9zdE1lc3NhZ2UoeyB0b3BpYzogT3V0cHV0V29ya2xldFJlcXVlc3RUb3BpYy5TVFJFQU1fUExBWUlORywgcGxheWluZyB9KVxuICB9XG59XG5cbnJlZ2lzdGVyUHJvY2Vzc29yKCdpbnB1dFByb2Nlc3NvcicsIElucHV0UHJvY2Vzc29yKVxuXG5yZWdpc3RlclByb2Nlc3Nvcignb3V0cHV0UHJvY2Vzc29yJywg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\n"